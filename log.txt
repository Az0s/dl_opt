================================================================================
线性注意力机制综合实验 (含 Torch Profiler)
================================================================================
GPU:  NVIDIA GeForce RTX 3090
显存: 23.6 GB
PyTorch:  2.8.0+cu128

检查依赖...
FLA:  OK
Flash Attention: OK

当前模型配置:
  Softmax: {'hidden_size': 256, 'num_layers': 4, 'num_heads': 4}
  Flash: {'hidden_size': 256, 'num_layers': 4, 'num_heads': 4}
  Linear: {'hidden_size': 256, 'num_layers': 4, 'num_heads': 4}
  GatedDeltaNet: {'hidden_size': 128, 'num_layers': 4, 'num_heads': 4}

================================================================================
阶段1: 预训练 (WikiText-2 本地数据)
================================================================================
加载本地数据:  /root/autodl-tmp/GatedDeltaNet/train-00000-of-00001.parquet
文本长度:  10916756 字符
vocab_size: 1015 | tokens: 10916756 | samples: 42643
加载本地数据:  /root/autodl-tmp/GatedDeltaNet/validation-00000-of-00001.parquet
文本长度:  1144610 字符
vocab_size: 1015 | tokens: 1144610 | samples: 4471

基础配置:
  vocab_size: 1015
  seq_len: 256
  batch_size: 128
  lr: 0.0005

======================================================================
各模型配置与参数量对比
======================================================================
Attention        hidden_size num_layers  num_heads    Total Params
----------------------------------------------------------------------
Softmax                  256          4          4       5,846,528
Flash                    256          4          4       5,846,528
Linear                   256          4          4       5,913,344
GatedDeltaNet            128          4          4       6,140,704
======================================================================


------------------------------------------------------------
训练:  Softmax (h=256, l=4, n=4)
------------------------------------------------------------
参数量: 3.77 M
Epoch 1 | Train Loss: 3.17 | Val Loss:  2.4449 | Val PPL: 11.53
Epoch 2 | Train Loss: 2.3433 | Val Loss:  2.1585 | Val PPL: 8.66
Epoch 3 | Train Loss: 2.1609 | Val Loss:  2.0345 | Val PPL: 7.65
Epoch 4 | Train Loss: 2.104 | Val Loss:  2.0039 | Val PPL: 7.42
Epoch 5 | Train Loss: 2.0914 | Val Loss:  2.0002 | Val PPL: 7.39
模型已保存

------------------------------------------------------------
训练:  Flash (h=256, l=4, n=4)
------------------------------------------------------------
参数量: 3.77 M
Epoch 1 | Train Loss: 3.1512 | Val Loss:  2.4416 | Val PPL: 11.49
Epoch 2 | Train Loss: 2.3573 | Val Loss:  2.1916 | Val PPL: 8.95
Epoch 3 | Train Loss: 2.1789 | Val Loss:  2.0611 | Val PPL: 7.85
Epoch 4 | Train Loss: 2.1151 | Val Loss:  2.0271 | Val PPL: 7.59
Epoch 5 | Train Loss: 2.1021 | Val Loss:  2.0225 | Val PPL: 7.56
模型已保存

------------------------------------------------------------
训练:  Linear (h=256, l=4, n=4)
------------------------------------------------------------
参数量: 3.83 M
Epoch 1 | Train Loss: 3.139 | Val Loss:  2.4623 | Val PPL: 11.73
Epoch 2 | Train Loss: 2.4323 | Val Loss:  2.3906 | Val PPL: 10.92
Epoch 3 | Train Loss: 2.3812 | Val Loss:  2.3534 | Val PPL: 10.52
Epoch 4 | Train Loss: 2.3571 | Val Loss:  2.3387 | Val PPL: 10.37
Epoch 5 | Train Loss: 2.3506 | Val Loss:  2.3373 | Val PPL: 10.35
模型已保存

------------------------------------------------------------
训练:  GatedDeltaNet (h=128, l=4, n=4)
------------------------------------------------------------
参数量: 5.1 M
Epoch 1 | Train Loss: 3.0636 | Val Loss:  1.6484 | Val PPL: 5.2
Epoch 2 | Train Loss: 1.5414 | Val Loss:  1.4575 | Val PPL: 4.3
Epoch 3 | Train Loss: 1.4234 | Val Loss:  1.4131 | Val PPL: 4.11
Epoch 4 | Train Loss: 1.3847 | Val Loss:  1.4003 | Val PPL: 4.06
Epoch 5 | Train Loss: 1.3745 | Val Loss:  1.3989 | Val PPL: 4.05
模型已保存

================================================================================
测试1: 训练效率
================================================================================

序列长度: 256
------------------------------------------------------------
  Softmax | 24.5±0.06ms | 1337286 tok/s | 1490.0MB
  Flash | 24.5±0.09ms | 1337270 tok/s | 1490.0MB
  Linear | 30.42±0.89ms | 1077139 tok/s | 1938.4MB
  GatedDeltaNet | 118.71±1.3ms | 276026 tok/s | 5726.4MB

序列长度: 512
------------------------------------------------------------
  Softmax | 48.22±0.31ms | 1358994 tok/s | 2907.7MB
  Flash | 48.14±0.41ms | 1361251 tok/s | 2907.7MB
  Linear | 55.2±0.2ms | 1187178 tok/s | 3804.1MB
  GatedDeltaNet | 232.76±0.52ms | 281559 tok/s | 11374.6MB

序列长度: 1024
------------------------------------------------------------
  Softmax | 98.13±0.38ms | 1335685 tok/s | 5746.6MB
  Flash | 97.79±0.45ms | 1340369 tok/s | 5746.6MB
  Linear | 103.39±0.29ms | 1267735 tok/s | 7539.0MB
  GatedDeltaNet | 455.03±0.57ms | 288048 tok/s | 22671.0MB

================================================================================
测试2: 内存扩展性
================================================================================

序列长度: 256
------------------------------------------------------------
  Softmax | Fwd: 144.7MB | Bwd: 241.3MB
  Flash | Fwd: 193.7MB | Bwd: 241.3MB
  Linear | Fwd: 305.7MB | Bwd: 288.8MB
  GatedDeltaNet | Fwd: 1726.0MB | Bwd: 2590.7MB

序列长度: 512
------------------------------------------------------------
  Softmax | Fwd: 269.2MB | Bwd: 434.3MB
  Flash | Fwd: 338.2MB | Bwd: 434.3MB
  Linear | Fwd: 562.2MB | Bwd: 529.3MB
  GatedDeltaNet | Fwd: 3401.3MB | Bwd: 5130.7MB

序列长度: 1024
------------------------------------------------------------
  Softmax | Fwd: 486.2MB | Bwd: 820.3MB
  Flash | Fwd: 627.2MB | Bwd: 820.3MB
  Linear | Fwd: 1075.2MB | Bwd: 1010.3MB
  GatedDeltaNet | Fwd: 6751.8MB | Bwd: 10210.7MB

序列长度: 2048
------------------------------------------------------------
  Softmax | Fwd: 920.2MB | Bwd: 1592.3MB
  Flash | Fwd: 1205.2MB | Bwd: 1592.3MB
  Linear | Fwd: 2101.2MB | Bwd: 1972.3MB
  GatedDeltaNet | Fwd: 13452.8MB | Bwd: 20370.7MB

================================================================================
测试3: Copy Task (记忆能力)
================================================================================

复制长度: 5
------------------------------------------------------------
  Softmax | Acc: 0.07%
  Flash | Acc: 0.09%
  Linear | Acc: 0.09%
  GatedDeltaNet | Acc: 0.07%

复制长度: 10
------------------------------------------------------------
  Softmax | Acc: 0.06%
  Flash | Acc: 0.22%
  Linear | Acc: 0.15%
  GatedDeltaNet | Acc: 0.09%

复制长度: 20
------------------------------------------------------------
  Softmax | Acc: 0.11%
  Flash | Acc: 0.13%
  Linear | Acc: 0.1%
  GatedDeltaNet | Acc: 0.07%

复制长度: 30
------------------------------------------------------------
  Softmax | Acc: 0.1%
  Flash | Acc: 0.1%
  Linear | Acc: 0.13%
  GatedDeltaNet | Acc: 0.09%

复制长度: 50
------------------------------------------------------------
  Softmax | Acc: 0.1%
  Flash | Acc: 0.11%
  Linear | Acc: 0.11%
  GatedDeltaNet | Acc: 0.09%

================================================================================
测试4: 关联记忆
================================================================================

KV对数: 3
------------------------------------------------------------
  Softmax | Acc: 0.0%
  Flash | Acc: 0.11%
  Linear | Acc: 0.33%
  GatedDeltaNet | Acc: 0.11%

KV对数: 5
------------------------------------------------------------
  Softmax | Acc: 0.11%
  Flash | Acc: 0.11%
  Linear | Acc: 0.22%
  GatedDeltaNet | Acc: 0.33%

KV对数: 8
------------------------------------------------------------
  Softmax | Acc: 0.33%
  Flash | Acc: 0.11%
  Linear | Acc: 0.67%
  GatedDeltaNet | Acc: 0.45%

KV对数: 10
------------------------------------------------------------
  Softmax | Acc: 0.22%
  Flash | Acc: 0.45%
  Linear | Acc: 0.33%
  GatedDeltaNet | Acc: 0.45%

KV对数: 15
------------------------------------------------------------
  Softmax | Acc: 0.0%
  Flash | Acc: 0.11%
  Linear | Acc: 0.0%
  GatedDeltaNet | Acc: 0.0%

================================================================================
测试5: 困惑度汇总
================================================================================
Softmax | Final PPL: 7.39 | Best PPL: 7.39
Flash | Final PPL: 7.56 | Best PPL: 7.56
Linear | Final PPL: 10.35 | Best PPL: 10.35
GatedDeltaNet | Final PPL: 4.05 | Best PPL: 4.05

================================================================================
测试6: 模型扩展性
================================================================================

Softmax 规模: ~1M
------------------------------------------------------------
  Softmax | 0.73M | 14.17ms | 1070.0MB

Softmax 规模: ~5M
------------------------------------------------------------
  Softmax | 3.83M | 50.35ms | 2911.7MB

Softmax 规模: ~15M
------------------------------------------------------------
  Softmax | 11.65M | 130.71ms | 5963.1MB

Softmax 规模: ~30M
------------------------------------------------------------
  Softmax | 26.56M | 242.92ms | 10239.4MB

Flash 规模: ~1M
------------------------------------------------------------
  Flash | 0.73M | 13.91ms | 1070.0MB

Flash 规模: ~5M
------------------------------------------------------------
  Flash | 3.83M | 49.62ms | 2911.7MB

Flash 规模: ~15M
------------------------------------------------------------
  Flash | 11.65M | 130.33ms | 5963.1MB

Flash 规模: ~30M
------------------------------------------------------------
  Flash | 26.56M | 242.46ms | 10239.4MB

Linear 规模: ~1M
------------------------------------------------------------
  Linear | 0.74M | 15.4ms | 1294.1MB

Linear 规模: ~5M
------------------------------------------------------------
  Linear | 3.85M | 53.53ms | 3807.9MB

Linear 规模: ~15M
------------------------------------------------------------
  Linear | 11.71M | 142.07ms | 7979.5MB

Linear 规模: ~30M
------------------------------------------------------------
  Linear | 26.69M | 269.12ms | 13824.2MB

GatedDeltaNet 规模: ~1M
------------------------------------------------------------
  GatedDeltaNet | 1.32M | 109.53ms | 7072.9MB

GatedDeltaNet 规模: ~5M
------------------------------------------------------------
  GatedDeltaNet | 5.13M | 232.42ms | 11374.6MB

GatedDeltaNet 规模: ~15M
------------------------------------------------------------
  GatedDeltaNet | 11.84M | 389.64ms | 16156.9MB

GatedDeltaNet 规模: ~30M
------------------------------------------------------------
  GatedDeltaNet | 21.82M | 542.16ms | 21422.1MB

================================================================================
Torch Profiler 性能分析
================================================================================

序列长度: 256
------------------------------------------------------------

  [Softmax] seq_len=256
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        44.16%     197.842ms        44.25%     198.272ms      19.827ms       0.000us         0.00%      14.591us       1.459us           0 B           0 B     -12.55 GB     -12.55 GB            10  
                                                forward         3.27%      14.647ms        11.81%      52.932ms       5.293ms       0.000us         0.00%      75.572ms       7.557ms           0 B           0 B      12.06 GB      -5.25 GB            10  
                                               aten::mm         6.28%      28.158ms         8.91%      39.936ms      59.607us      94.532ms        39.84%      94.532ms     141.093us           0 B           0 B       8.97 GB       8.97 GB           670  
                                              optimizer         0.27%       1.219ms         8.42%      37.732ms       3.773ms       0.000us         0.00%       2.407ms     240.741us           0 B           0 B     -71.84 MB           0 B            10  
       autograd::engine::evaluate_function: MmBackward0         0.73%       3.277ms         8.20%      36.751ms     216.184us       0.000us         0.00%      34.487ms     202.866us           0 B           0 B    -615.04 MB      -3.28 GB           170  
                              Optimizer.step#AdamW.step         4.84%      21.694ms         7.84%      35.104ms       3.510ms       0.000us         0.00%       2.407ms     240.741us           0 B         -40 B           0 B     -71.84 MB            10  
                                            MmBackward0         0.89%       3.999ms         7.47%      33.474ms     196.905us       0.000us         0.00%      34.487ms     202.866us           0 B           0 B       2.68 GB           0 B           170  
    autograd::engine::evaluate_function: AddmmBackward0         0.64%       2.876ms         5.58%      25.004ms     312.548us       0.000us         0.00%      49.104ms     613.797us           0 B           0 B      -3.09 GB      -6.25 GB            80  
                                       cudaLaunchKernel         5.27%      23.627ms         5.27%      23.627ms      11.041us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          2140  
     autograd::engine::evaluate_function: ViewBackward0         1.47%       6.575ms         3.79%      16.976ms      33.951us       0.000us         0.00%       4.926ms       9.852us           0 B           0 B      -1.25 GB      -1.88 GB           500  
                                           aten::linear         0.29%       1.290ms         3.70%      16.582ms      66.328us       0.000us         0.00%      39.923ms     159.693us           0 B           0 B       6.25 GB           0 B           250  
                                         AddmmBackward0         0.48%       2.170ms         3.59%      16.074ms     200.923us       0.000us         0.00%      43.124ms     539.050us           0 B           0 B       3.16 GB           0 B            80  
autograd::engine::evaluate_function: NativeLayerNorm...         0.77%       3.454ms         3.32%      14.874ms     165.265us       0.000us         0.00%      25.307ms     281.192us           0 B           0 B      -2.68 GB      -4.08 GB            90  
                                                aten::t         1.44%       6.446ms         3.28%      14.704ms      11.763us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          1250  
                                        aten::transpose         2.22%       9.942ms         2.98%      13.368ms       6.521us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          2050  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 448.031ms
Self CUDA time total: 237.309ms

  Trace 已保存:  ./profiler_results/Softmax_seq256_trace.json
  Peak Memory: 1553.98 MB

  [Flash] seq_len=256
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        43.50%     197.750ms        43.60%     198.165ms      19.816ms       0.000us         0.00%      14.879us       1.488us           0 B           0 B     -12.55 GB     -12.55 GB            10  
                                                forward         3.48%      15.818ms        12.64%      57.473ms       5.747ms       0.000us         0.00%      76.175ms       7.617ms           0 B           0 B      11.99 GB      -5.32 GB            10  
                                               aten::mm         6.28%      28.545ms         8.91%      40.508ms      60.460us      95.637ms        40.00%      95.637ms     142.742us           0 B           0 B       8.97 GB       8.97 GB           670  
                                              optimizer         0.26%       1.197ms         8.10%      36.834ms       3.683ms       0.000us         0.00%       2.404ms     240.437us           0 B           0 B     -71.84 MB           0 B            10  
       autograd::engine::evaluate_function: MmBackward0         0.72%       3.293ms         8.04%      36.532ms     214.891us       0.000us         0.00%      34.869ms     205.114us           0 B           0 B    -615.04 MB      -3.28 GB           170  
                              Optimizer.step#AdamW.step         4.64%      21.107ms         7.53%      34.215ms       3.421ms       0.000us         0.00%       2.404ms     240.437us           0 B         -40 B           0 B     -71.84 MB            10  
                                            MmBackward0         0.87%       3.932ms         7.31%      33.238ms     195.520us       0.000us         0.00%      34.869ms     205.114us           0 B           0 B       2.68 GB           0 B           170  
    autograd::engine::evaluate_function: AddmmBackward0         0.63%       2.845ms         5.35%      24.314ms     303.930us       0.000us         0.00%      49.627ms     620.341us           0 B           0 B      -3.09 GB      -6.25 GB            80  
                                       cudaLaunchKernel         5.22%      23.711ms         5.22%      23.711ms      11.080us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          2140  
autograd::engine::evaluate_function: FlashAttnFuncBa...         0.36%       1.623ms         5.18%      23.563ms     589.071us       0.000us         0.00%      18.271ms     456.781us           0 B           0 B      -1.27 GB      -3.14 GB            40  
                                  FlashAttnFuncBackward         1.37%       6.226ms         4.83%      21.940ms     548.493us       0.000us         0.00%      18.271ms     456.781us           0 B           0 B       1.88 GB     -20.00 MB            40  
                                           aten::linear         0.29%       1.339ms         3.75%      17.047ms      68.189us       0.000us         0.00%      40.493ms     161.971us           0 B           0 B       6.25 GB           0 B           250  
     autograd::engine::evaluate_function: ViewBackward0         1.45%       6.594ms         3.66%      16.650ms      33.301us       0.000us         0.00%       4.926ms       9.852us           0 B           0 B      -1.25 GB      -1.88 GB           500  
                                         AddmmBackward0         0.43%       1.950ms         3.41%      15.489ms     193.613us       0.000us         0.00%      43.611ms     545.137us           0 B           0 B       3.16 GB           0 B            80  
autograd::engine::evaluate_function: NativeLayerNorm...         0.71%       3.221ms         3.19%      14.480ms     160.887us       0.000us         0.00%      25.528ms     283.642us           0 B           0 B      -2.68 GB      -4.08 GB            90  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 454.549ms
Self CUDA time total: 239.066ms

  Trace 已保存:  ./profiler_results/Flash_seq256_trace.json
  Peak Memory: 1553.98 MB

  [Linear] seq_len=256
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        40.97%     262.971ms        41.04%     263.424ms      26.342ms       0.000us         0.00%      14.303us       1.430us           0 B           0 B     -16.92 GB     -16.92 GB            10  
                                                forward         3.92%      25.155ms        15.40%      98.867ms       9.887ms       0.000us         0.00%      88.772ms       8.877ms           0 B           0 B      16.36 GB      -5.32 GB            10  
                                              optimizer         0.19%       1.219ms         8.89%      57.027ms       5.703ms       0.000us         0.00%       2.556ms     255.580us           0 B           0 B     -73.18 MB           0 B            10  
                              Optimizer.step#AdamW.step         5.07%      32.511ms         8.38%      53.767ms       5.377ms       0.000us         0.00%       2.556ms     255.580us           0 B         -40 B           0 B     -73.18 MB            10  
    autograd::engine::evaluate_function: AddmmBackward0         0.94%       6.009ms         8.11%      52.035ms     216.813us       0.000us         0.00%      71.553ms     298.138us           0 B           0 B      -4.33 GB     -10.00 GB           240  
                                               aten::mm         4.94%      31.675ms         7.13%      45.745ms      46.207us     108.771ms        38.05%     108.771ms     109.870us           0 B           0 B      11.47 GB      11.47 GB           990  
autograd::engine::evaluate_function: LayerNormFuncti...         0.16%       1.011ms         5.22%      33.525ms     838.129us       0.000us         0.00%       2.944ms      73.591us           0 B           0 B    -659.98 MB      -1.27 GB            40  
                                         AddmmBackward0         0.65%       4.190ms         5.18%      33.263ms     138.596us       0.000us         0.00%      58.187ms     242.445us           0 B           0 B       5.67 GB           0 B           240  
                              LayerNormFunctionBackward         3.98%      25.556ms         5.07%      32.515ms     812.865us       2.550ms         0.89%       2.944ms      73.591us           0 B           0 B     640.02 MB    -840.00 KB            40  
                                       cudaLaunchKernel         4.55%      29.212ms         4.55%      29.212ms       9.129us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          3200  
autograd::engine::evaluate_function: FusedChunkFunct...         0.18%       1.139ms         4.40%      28.258ms     706.439us       0.000us         0.00%      14.632ms     365.791us           0 B           0 B    -640.00 MB      -2.50 GB            40  
                                           aten::linear         0.42%       2.723ms         4.23%      27.156ms      66.234us       0.000us         0.00%      48.089ms     117.289us           0 B           0 B       8.75 GB           0 B           410  
                             FusedChunkFunctionBackward         3.86%      24.794ms         4.23%      27.118ms     677.960us      14.632ms         5.12%      14.632ms     365.791us           0 B           0 B       1.88 GB           0 B            40  
       autograd::engine::evaluate_function: MmBackward0         0.39%       2.491ms         4.04%      25.953ms     152.664us       0.000us         0.00%      33.884ms     199.316us           0 B           0 B      -1.23 GB      -3.91 GB           170  
                                            MmBackward0         0.44%       2.804ms         3.66%      23.462ms     138.014us       0.000us         0.00%      33.884ms     199.316us           0 B           0 B       2.68 GB           0 B           170  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 641.813ms
Self CUDA time total: 285.833ms

  Trace 已保存:  ./profiler_results/Linear_seq256_trace.json
  Peak Memory: 2002.38 MB

  [GatedDeltaNet] seq_len=256
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        19.94%     354.592ms        35.96%     639.628ms      63.963ms       0.000us         0.00%      15.424us       1.542us           0 B           0 B     -41.03 GB     -41.03 GB            10  
                                    Command Buffer Full        20.07%     356.977ms        20.07%     356.977ms     611.261us       3.186ms         0.27%       3.186ms       5.456us           0 B           0 B           0 B           0 B           584  
autograd::engine::evaluate_function: ChunkGatedDelta...         0.07%       1.298ms        17.83%     317.155ms       7.929ms       0.000us         0.00%     551.730ms      13.793ms           0 B           0 B      -5.65 GB     -15.68 GB            40  
                    ChunkGatedDeltaRuleFunctionBackward         5.06%      90.052ms        17.76%     315.856ms       7.896ms     541.585ms        46.49%     551.730ms      13.793ms           0 B           0 B      10.03 GB     -72.70 GB            40  
                                                forward         2.18%      38.833ms        15.22%     270.730ms      27.073ms       0.000us         0.00%     308.745ms      30.875ms           0 B           0 B      40.49 GB      -8.04 GB            10  
                                       cudaLaunchKernel         9.72%     172.944ms        13.70%     243.685ms      66.947us       0.000us         0.00%       3.186ms       0.875us           0 B           0 B           0 B           0 B          3640  
                                  cudaDeviceSynchronize        11.96%     212.736ms        11.96%     212.736ms     212.736ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                       cuLaunchKernelEx         8.08%     143.751ms         8.17%     145.337ms     129.765us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          1120  
autograd::engine::evaluate_function: CausalConv1dFun...         0.10%       1.774ms         5.02%      89.304ms     744.202us       0.000us         0.00%     100.926ms     841.052us           0 B           0 B     -10.00 GB     -20.00 GB           120  
                           CausalConv1dFunctionBackward         3.97%      70.567ms         4.92%      87.531ms     729.421us      97.865ms         8.40%     100.926ms     841.052us           0 B           0 B      10.00 GB     -11.25 GB           120  
                                              aten::sum         0.47%       8.277ms         4.55%      80.890ms     218.622us       8.637ms         0.74%       8.637ms      23.343us           0 B           0 B      23.30 MB      23.30 MB           370  
                            ChunkGatedDeltaRuleFunction         3.24%      57.561ms         3.74%      66.610ms       1.665ms     181.028ms        15.54%     181.833ms       4.546ms           0 B           0 B      10.68 GB     -33.75 GB            40  
                                           aten::linear         0.09%       1.559ms         3.39%      60.275ms     162.906us       0.000us         0.00%      60.967ms     164.775us           0 B           0 B      17.52 GB           0 B           370  
                                               aten::mm         1.53%      27.148ms         2.66%      47.315ms      45.937us     170.047ms        14.60%     170.946ms     165.967us           0 B           0 B      24.56 GB      24.56 GB          1030  
autograd::engine::evaluate_function: EmbeddingBackwa...         0.01%     173.448us         2.56%      45.462ms       2.273ms       0.000us         0.00%       1.328ms      66.399us           0 B           0 B     -77.29 MB     -80.64 MB            20  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 1.779s
Self CUDA time total: 1.165s

  Trace 已保存:  ./profiler_results/GatedDeltaNet_seq256_trace.json
  Peak Memory: 5790.4 MB

序列长度: 512
------------------------------------------------------------

  [Softmax] seq_len=512
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                  cudaDeviceSynchronize        29.08%     180.840ms        29.08%     180.840ms     180.840ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                               backward        22.46%     139.680ms        29.04%     180.622ms      18.062ms       0.000us         0.00%      15.966us       1.597us           0 B           0 B     -25.16 GB     -25.16 GB            10  
                                       cudaLaunchKernel         9.17%      57.017ms        13.88%      86.306ms      39.590us       0.000us         0.00%      22.239ms      10.201us           0 B           0 B           0 B           0 B          2180  
                                                forward         2.12%      13.168ms        11.89%      73.974ms       7.397ms       0.000us         0.00%     176.770ms      17.677ms           0 B           0 B      24.04 GB     -10.56 GB            10  
                                    Command Buffer Full        11.38%      70.753ms        11.38%      70.753ms     237.425us      27.891ms         5.94%      27.891ms      93.593us           0 B           0 B           0 B           0 B           298  
                                               aten::mm         3.34%      20.759ms         7.29%      45.352ms      67.689us     174.726ms        37.24%     177.642ms     265.137us           0 B           0 B      17.86 GB      17.86 GB           670  
       autograd::engine::evaluate_function: MmBackward0         0.38%       2.341ms         5.46%      33.960ms     199.766us       0.000us         0.00%      64.968ms     382.164us           0 B           0 B      -1.21 GB      -6.55 GB           170  
                                            MmBackward0         0.44%       2.760ms         5.08%      31.620ms     185.998us       0.000us         0.00%      64.968ms     382.164us           0 B           0 B       5.34 GB           0 B           170  
                                              optimizer         0.17%       1.066ms         5.00%      31.078ms       3.108ms       0.000us         0.00%       2.488ms     248.760us           0 B           0 B     -73.09 MB           0 B            10  
    autograd::engine::evaluate_function: AddmmBackward0         0.34%       2.138ms         4.63%      28.792ms     359.896us       0.000us         0.00%      89.212ms       1.115ms           0 B           0 B      -6.21 GB     -12.50 GB            80  
                              Optimizer.step#AdamW.step         2.87%      17.850ms         4.63%      28.782ms       2.878ms       0.000us         0.00%       2.488ms     248.760us           0 B         -40 B           0 B     -73.09 MB            10  
autograd::engine::evaluate_function: NativeLayerNorm...         0.41%       2.521ms         3.66%      22.790ms     253.221us       0.000us         0.00%      51.017ms     566.861us           0 B           0 B      -5.36 GB      -8.17 GB            90  
                                           aten::linear         0.18%       1.098ms         3.63%      22.557ms      90.230us       0.000us         0.00%      86.597ms     346.390us           0 B           0 B      12.49 GB           0 B           250  
                                         AddmmBackward0         0.23%       1.414ms         2.45%      15.207ms     190.091us       0.000us         0.00%      79.012ms     987.650us           0 B           0 B       6.29 GB           0 B            80  
                                              aten::add         0.34%       2.099ms         2.29%      14.228ms     109.448us      15.371ms         3.28%      18.267ms     140.513us           0 B           0 B       4.06 GB       4.06 GB           130  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 621.940ms
Self CUDA time total: 469.188ms

  Trace 已保存:  ./profiler_results/Softmax_seq512_trace.json
  Peak Memory: 3034.61 MB

  [Flash] seq_len=512
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        29.64%     187.995ms        31.33%     198.700ms      19.870ms       0.000us         0.00%      16.094us       1.609us           0 B           0 B     -25.16 GB     -25.16 GB            10  
                                  cudaDeviceSynchronize        28.26%     179.272ms        28.26%     179.272ms     179.272ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                                forward         2.34%      14.827ms         8.93%      56.657ms       5.666ms       0.000us         0.00%     150.805ms      15.081ms           0 B           0 B      23.98 GB     -10.62 GB            10  
                                               aten::mm         4.25%      26.973ms         6.52%      41.375ms      61.753us     175.113ms        37.32%     175.390ms     261.777us           0 B           0 B      17.86 GB      17.86 GB           670  
       autograd::engine::evaluate_function: MmBackward0         0.50%       3.140ms         5.68%      36.015ms     211.853us       0.000us         0.00%      65.062ms     382.715us           0 B           0 B      -1.21 GB      -6.55 GB           170  
                                       cudaLaunchKernel         5.34%      33.859ms         5.67%      35.957ms      16.494us       0.000us         0.00%     803.204us       0.368us           0 B           0 B           0 B           0 B          2180  
                                              optimizer         0.17%       1.071ms         5.40%      34.228ms       3.423ms       0.000us         0.00%       2.496ms     249.579us           0 B           0 B     -73.09 MB           0 B            10  
                                            MmBackward0         0.59%       3.722ms         5.18%      32.875ms     193.383us       0.000us         0.00%      65.062ms     382.715us           0 B           0 B       5.34 GB           0 B           170  
                              Optimizer.step#AdamW.step         3.07%      19.498ms         5.02%      31.846ms       3.185ms       0.000us         0.00%       2.496ms     249.579us           0 B         -40 B           0 B     -73.09 MB            10  
    autograd::engine::evaluate_function: AddmmBackward0         0.43%       2.727ms         4.16%      26.390ms     329.869us       0.000us         0.00%      89.174ms       1.115ms           0 B           0 B      -6.21 GB     -12.50 GB            80  
autograd::engine::evaluate_function: FlashAttnFuncBa...         0.25%       1.595ms         3.52%      22.350ms     558.756us       0.000us         0.00%      49.151ms       1.229ms           0 B           0 B      -2.54 GB      -6.29 GB            40  
                                  FlashAttnFuncBackward         0.93%       5.903ms         3.27%      20.755ms     518.876us       0.000us         0.00%      49.151ms       1.229ms           0 B           0 B       3.75 GB     -40.00 MB            40  
autograd::engine::evaluate_function: NativeLayerNorm...         0.50%       3.143ms         2.77%      17.589ms     195.436us       0.000us         0.00%      51.058ms     567.308us           0 B           0 B      -5.36 GB      -8.17 GB            90  
                                           aten::linear         0.20%       1.257ms         2.74%      17.374ms      69.494us       0.000us         0.00%      74.777ms     299.109us           0 B           0 B      12.49 GB           0 B           250  
     autograd::engine::evaluate_function: ViewBackward0         1.00%       6.366ms         2.56%      16.246ms      32.492us       0.000us         0.00%       9.669ms      19.338us           0 B           0 B      -2.50 GB      -3.75 GB           500  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 634.284ms
Self CUDA time total: 469.218ms

  Trace 已保存:  ./profiler_results/Flash_seq512_trace.json
  Peak Memory: 3034.61 MB

  [Linear] seq_len=512
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward        34.90%     268.003ms        34.96%     268.507ms      26.851ms       0.000us         0.00%      15.836us       1.584us           0 B           0 B     -33.91 GB     -33.91 GB            10  
                                  cudaDeviceSynchronize        16.55%     127.112ms        16.55%     127.112ms     127.112ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                                forward         3.14%      24.091ms        12.24%      93.981ms       9.398ms       0.000us         0.00%     167.865ms      16.786ms           0 B           0 B      32.73 GB     -10.62 GB            10  
    autograd::engine::evaluate_function: AddmmBackward0         0.80%       6.129ms         6.93%      53.255ms     221.897us       0.000us         0.00%     128.888ms     537.034us           0 B           0 B      -8.71 GB     -20.00 GB           240  
                                              optimizer         0.15%       1.125ms         6.70%      51.466ms       5.147ms       0.000us         0.00%       2.658ms     265.836us           0 B           0 B     -74.43 MB           0 B            10  
                              Optimizer.step#AdamW.step         3.85%      29.573ms         6.31%      48.459ms       4.846ms       0.000us         0.00%       2.658ms     265.836us           0 B         -40 B           0 B     -74.43 MB            10  
                                               aten::mm         4.15%      31.892ms         5.97%      45.883ms      46.347us     203.099ms        37.59%     203.099ms     205.151us           0 B           0 B      22.87 GB      22.87 GB           990  
                                         AddmmBackward0         0.55%       4.233ms         4.42%      33.944ms     141.435us       0.000us         0.00%     107.625ms     448.437us           0 B           0 B      11.29 GB           0 B           240  
autograd::engine::evaluate_function: LayerNormFuncti...         0.13%       1.036ms         4.39%      33.717ms     842.914us       0.000us         0.00%       5.409ms     135.229us           0 B           0 B      -1.29 GB      -2.54 GB            40  
                              LayerNormFunctionBackward         3.37%      25.848ms         4.26%      32.681ms     817.016us       5.000ms         0.93%       5.409ms     135.229us           0 B           0 B       1.25 GB    -840.00 KB            40  
                                       cudaLaunchKernel         3.90%      29.918ms         3.90%      29.918ms       9.234us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B          3240  
autograd::engine::evaluate_function: FusedChunkFunct...         0.15%       1.186ms         3.78%      29.034ms     725.855us       0.000us         0.00%      28.473ms     711.835us           0 B           0 B      -1.25 GB      -5.00 GB            40  
                             FusedChunkFunctionBackward         3.32%      25.519ms         3.63%      27.848ms     696.211us      28.473ms         5.27%      28.473ms     711.835us           0 B           0 B       3.75 GB           0 B            40  
       autograd::engine::evaluate_function: MmBackward0         0.34%       2.578ms         3.38%      25.976ms     152.799us       0.000us         0.00%      64.804ms     381.198us           0 B           0 B      -2.46 GB      -7.80 GB           170  
                                           aten::linear         0.33%       2.528ms         3.36%      25.772ms      62.859us       0.000us         0.00%      87.261ms     212.832us           0 B           0 B      17.49 GB           0 B           410  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 767.992ms
Self CUDA time total: 540.373ms

  Trace 已保存:  ./profiler_results/Linear_seq512_trace.json
  Peak Memory: 3931.01 MB

  [GatedDeltaNet] seq_len=512
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                    Command Buffer Full        37.00%        1.319s        37.00%        1.319s       1.063ms      36.592ms         1.60%      36.592ms      29.510us           0 B           0 B           0 B           0 B          1240  
                                               backward         9.01%     321.172ms        36.33%        1.295s     129.475ms       0.000us         0.00%      16.638us       1.664us           0 B           0 B     -82.14 GB     -82.14 GB            10  
                                       cudaLaunchKernel        21.63%     771.065ms        27.56%     982.319ms     272.866us       0.000us         0.00%      26.488ms       7.358us           0 B           0 B           0 B           0 B          3600  
                                               aten::mm         0.74%      26.373ms        18.60%     662.954ms     643.645us     329.220ms        14.36%     352.186ms     341.929us           0 B           0 B      49.02 GB      49.02 GB          1030  
    autograd::engine::evaluate_function: AddmmBackward0         0.04%       1.434ms        14.70%     523.873ms       6.548ms       0.000us         0.00%      32.200ms     402.501us           0 B           0 B      -3.12 GB      -6.25 GB            80  
                                                forward         1.09%      38.839ms        13.65%     486.545ms      48.654ms       0.000us         0.00%     637.224ms      63.722ms           0 B           0 B      80.99 GB     -16.05 GB            10  
                                  cudaDeviceSynchronize        11.65%     415.168ms        11.65%     415.168ms     415.168ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                         AddmmBackward0         0.02%     875.312us        11.61%     413.641ms       5.171ms       0.000us         0.00%      24.818ms     310.227us           0 B           0 B       3.13 GB           0 B            80  
                                         cuLaunchKernel         2.09%      74.619ms         4.76%     169.657ms     308.468us       0.000us         0.00%      10.104ms      18.371us           0 B           0 B           0 B           0 B           550  
                                           aten::linear         0.04%       1.527ms         4.46%     159.062ms     429.896us       0.000us         0.00%     143.964ms     389.091us           0 B           0 B      35.03 GB           0 B           370  
                                        cudaMemsetAsync         4.26%     151.855ms         4.26%     151.855ms     361.560us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B           420  
                                           aten::matmul         0.06%       2.152ms         4.04%     143.933ms     496.321us       0.000us         0.00%     126.720ms     436.966us           0 B           0 B      31.90 GB           0 B           290  
                                              aten::sum         0.23%       8.085ms         3.52%     125.573ms     339.387us      13.677ms         0.60%      13.677ms      36.965us           0 B           0 B      43.93 MB      43.93 MB           370  
       autograd::engine::evaluate_function: MmBackward0         0.07%       2.578ms         3.43%     122.222ms     421.456us       0.000us         0.00%     200.648ms     691.890us           0 B           0 B     -28.07 GB     -42.06 GB           290  
                                            MmBackward0         0.08%       2.977ms         3.36%     119.644ms     412.566us       0.000us         0.00%     200.648ms     691.890us           0 B           0 B      13.99 GB           0 B           290  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 3.564s
Self CUDA time total: 2.292s

  Trace 已保存:  ./profiler_results/GatedDeltaNet_seq512_trace.json
  Peak Memory: 11501.46 MB

序列长度: 1024
------------------------------------------------------------

  [Softmax] seq_len=1024
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward         7.95%     112.194ms        33.29%     469.926ms      46.993ms       0.000us         0.00%      24.736us       2.474us           0 B           0 B     -50.38 GB     -50.38 GB            10  
                                    Command Buffer Full        32.10%     453.164ms        32.10%     453.164ms     467.180us     106.118ms        11.04%     106.118ms     109.400us           0 B           0 B           0 B           0 B           970  
                                       cudaLaunchKernel        17.68%     249.531ms        22.83%     322.310ms     139.528us       0.000us         0.00%      72.052ms      31.191us           0 B           0 B           0 B           0 B          2310  
                                  cudaDeviceSynchronize        22.42%     316.420ms        22.42%     316.420ms     316.420ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                               aten::mm         1.19%      16.833ms        10.84%     152.980ms     228.328us     344.941ms        35.89%     367.997ms     549.250us           0 B           0 B      35.67 GB      35.67 GB           670  
autograd::engine::evaluate_function: NativeLayerNorm...         0.14%       1.910ms        10.39%     146.710ms       1.630ms       0.000us         0.00%      60.115ms     667.939us           0 B           0 B     -10.71 GB     -16.34 GB            90  
                                                forward         0.93%      13.102ms         9.79%     138.166ms      13.817ms       0.000us         0.00%     421.039ms      42.104ms           0 B           0 B      48.09 GB     -21.12 GB            10  
                               NativeLayerNormBackward0         0.04%     517.044us         8.73%     123.242ms       1.369ms       0.000us         0.00%      41.253ms     458.366us           0 B           0 B       5.63 GB           0 B            90  
                       aten::native_layer_norm_backward         0.19%       2.681ms         8.69%     122.725ms       1.364ms      39.136ms         4.07%      41.253ms     458.366us           0 B           0 B       5.63 GB    -380.34 MB            90  
                                              aten::sum         0.40%       5.697ms         7.91%     111.650ms     413.517us      21.005ms         2.19%      21.005ms      77.798us           0 B           0 B       5.19 MB       5.19 MB           270  
       autograd::engine::evaluate_function: MmBackward0         0.12%       1.717ms         7.02%      99.098ms     582.930us       0.000us         0.00%     126.451ms     743.828us           0 B           0 B      -2.45 GB     -13.10 GB           170  
                                            MmBackward0         0.14%       2.014ms         6.90%      97.381ms     572.831us       0.000us         0.00%     126.451ms     743.828us           0 B           0 B      10.65 GB           0 B           170  
                                        cudaMemsetAsync         6.25%      88.198ms         6.25%      88.198ms     215.117us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B           410  
    autograd::engine::evaluate_function: AddmmBackward0         0.11%       1.559ms         4.62%      65.230ms     815.374us       0.000us         0.00%     176.643ms       2.208ms           0 B           0 B     -12.46 GB     -25.00 GB            80  
                                         cuLaunchKernel         2.90%      40.979ms         4.56%      64.389ms     207.707us       0.000us         0.00%      34.066ms     109.891us           0 B           0 B           0 B           0 B           310  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 1.412s
Self CUDA time total: 961.032ms

  Trace 已保存:  ./profiler_results/Softmax_seq1024_trace.json
  Peak Memory: 6000.61 MB

  [Flash] seq_len=1024
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward         8.76%     123.175ms        33.34%     468.815ms      46.881ms       0.000us         0.00%      21.692us       2.169us           0 B           0 B     -50.39 GB     -50.39 GB            10  
                                    Command Buffer Full        30.79%     432.994ms        30.79%     432.994ms     473.218us      82.151ms         8.58%      82.151ms      89.782us           0 B           0 B           0 B           0 B           915  
                                  cudaDeviceSynchronize        22.46%     315.806ms        22.46%     315.806ms     315.806ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                       cudaLaunchKernel        17.25%     242.645ms        21.92%     308.335ms     133.478us       0.000us         0.00%      51.910ms      22.472us           0 B           0 B           0 B           0 B          2310  
                                               aten::mm         1.29%      18.149ms        10.68%     150.259ms     224.267us     344.408ms        35.99%     365.217ms     545.100us           0 B           0 B      35.67 GB      35.67 GB           670  
autograd::engine::evaluate_function: NativeLayerNorm...         0.15%       2.074ms        10.13%     142.529ms       1.584ms       0.000us         0.00%      59.970ms     666.338us           0 B           0 B     -10.71 GB     -16.34 GB            90  
                                                forward         1.04%      14.560ms         9.55%     134.373ms      13.437ms       0.000us         0.00%     396.131ms      39.613ms           0 B           0 B      47.97 GB     -21.24 GB            10  
                               NativeLayerNormBackward0         0.04%     561.566us         8.53%     119.950ms       1.333ms       0.000us         0.00%      41.132ms     457.022us           0 B           0 B       5.63 GB           0 B            90  
                       aten::native_layer_norm_backward         0.20%       2.856ms         8.49%     119.389ms       1.327ms      39.022ms         4.08%      41.132ms     457.022us           0 B           0 B       5.63 GB    -382.59 MB            90  
                                              aten::sum         0.43%       6.036ms         7.68%     108.031ms     400.114us      20.995ms         2.19%      20.995ms      77.760us           0 B           0 B       5.19 MB       5.19 MB           270  
       autograd::engine::evaluate_function: MmBackward0         0.14%       1.901ms         6.99%      98.285ms     578.145us       0.000us         0.00%     126.218ms     742.457us           0 B           0 B      -2.45 GB     -13.10 GB           170  
                                            MmBackward0         0.17%       2.339ms         6.85%      96.384ms     566.965us       0.000us         0.00%     126.218ms     742.457us           0 B           0 B      10.65 GB           0 B           170  
                                        cudaMemsetAsync         6.09%      85.685ms         6.09%      85.685ms     208.988us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B           410  
    autograd::engine::evaluate_function: AddmmBackward0         0.12%       1.740ms         4.63%      65.048ms     813.096us       0.000us         0.00%     176.334ms       2.204ms           0 B           0 B     -12.46 GB     -25.00 GB            80  
                                         cuLaunchKernel         2.81%      39.554ms         4.39%      61.766ms     199.244us       0.000us         0.00%      30.241ms      97.552us           0 B           0 B           0 B           0 B           310  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 1.406s
Self CUDA time total: 957.015ms

  Trace 已保存:  ./profiler_results/Flash_seq1024_trace.json
  Peak Memory: 6000.61 MB

  [Linear] seq_len=1024
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                               backward         9.97%     161.189ms        38.51%     622.702ms      62.270ms       0.000us         0.00%      16.287us       1.629us           0 B           0 B     -67.88 GB     -67.88 GB            10  
                                    Command Buffer Full        30.90%     499.574ms        30.90%     499.574ms     337.550us      66.128ms         6.51%      66.128ms      44.681us           0 B           0 B           0 B           0 B          1480  
                                       cudaLaunchKernel        23.72%     383.616ms        25.68%     415.246ms     123.218us       0.000us         0.00%      36.908ms      10.952us           0 B           0 B           0 B           0 B          3370  
                                  cudaDeviceSynchronize        13.60%     219.976ms        13.60%     219.976ms     219.976ms       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B             1  
                                               aten::mm         1.26%      20.448ms        11.03%     178.359ms     180.161us     397.466ms        39.14%     417.618ms     421.837us           0 B           0 B      45.67 GB      45.67 GB           990  
    autograd::engine::evaluate_function: AddmmBackward0         0.23%       3.658ms         9.96%     161.036ms     670.985us       0.000us         0.00%     249.354ms       1.039ms           0 B           0 B     -17.46 GB     -40.00 GB           240  
autograd::engine::evaluate_function: NativeLayerNorm...         0.10%       1.608ms         9.45%     152.872ms       1.699ms       0.000us         0.00%      59.939ms     665.985us           0 B           0 B     -10.71 GB     -16.34 GB            90  
                                              aten::sum         0.52%       8.372ms         9.18%     148.499ms     315.954us      40.981ms         4.04%      40.981ms      87.194us           0 B           0 B       5.28 MB       5.28 MB           470  
                               NativeLayerNormBackward0         0.03%     473.669us         8.11%     131.177ms       1.458ms       0.000us         0.00%      41.087ms     456.525us           0 B           0 B       5.63 GB           0 B            90  
                       aten::native_layer_norm_backward         0.14%       2.275ms         8.08%     130.703ms       1.452ms      38.969ms         3.84%      41.087ms     456.525us           0 B           0 B       5.63 GB    -382.59 MB            90  
                                                forward         1.38%      22.248ms         7.83%     126.616ms      12.662ms       0.000us         0.00%     395.387ms      39.539ms           0 B           0 B      65.47 GB     -21.24 GB            10  
       autograd::engine::evaluate_function: MmBackward0         0.09%       1.501ms         5.71%      92.406ms     543.566us       0.000us         0.00%     126.096ms     741.741us           0 B           0 B      -4.95 GB     -15.60 GB           170  
                                            MmBackward0         0.10%       1.671ms         5.62%      90.905ms     534.736us       0.000us         0.00%     126.096ms     741.741us           0 B           0 B      10.65 GB           0 B           170  
                                        cudaMemsetAsync         5.37%      86.756ms         5.37%      86.756ms     152.203us       0.000us         0.00%       0.000us       0.000us           0 B           0 B           0 B           0 B           570  
                                         AddmmBackward0         0.16%       2.570ms         5.01%      80.948ms     337.282us       0.000us         0.00%     211.698ms     882.075us           0 B           0 B      22.54 GB           0 B           240  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 1.617s
Self CUDA time total: 1.016s

  Trace 已保存:  ./profiler_results/Linear_seq1024_trace.json
  Peak Memory: 7793.01 MB
  GatedDeltaNet | Error: CUDA out of memory. Tried to allocate 512.00 MiB. GPU 0 has a total capacity of 

汇总已保存:  ./profiler_results/profile_summary.csv
